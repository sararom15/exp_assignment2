\hypertarget{classrobot__following_1_1image__feature}{}\section{robot\+\_\+following.\+image\+\_\+feature Class Reference}
\label{classrobot__following_1_1image__feature}\index{robot\+\_\+following.\+image\+\_\+feature@{robot\+\_\+following.\+image\+\_\+feature}}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \hyperlink{classrobot__following_1_1image__feature_ad21c13434a4653ea1a64fb00a742a3ae}{\+\_\+\+\_\+init\+\_\+\+\_\+} (self)
\item 
def \hyperlink{classrobot__following_1_1image__feature_af3eddd8a93175ab03651d9ea0352ab56}{callback} (self, ros\+\_\+data)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classrobot__following_1_1image__feature_a1246d1d342e919f2f2a00d3f8f887245}\label{classrobot__following_1_1image__feature_a1246d1d342e919f2f2a00d3f8f887245}} 
{\bfseries image\+\_\+pub}
\item 
\mbox{\Hypertarget{classrobot__following_1_1image__feature_a745a8de4e922b376f83df74a882d7d2a}\label{classrobot__following_1_1image__feature_a745a8de4e922b376f83df74a882d7d2a}} 
{\bfseries vel\+\_\+pub}
\item 
\mbox{\Hypertarget{classrobot__following_1_1image__feature_a08612a4f188d867aca7844e1e30fb44e}\label{classrobot__following_1_1image__feature_a08612a4f188d867aca7844e1e30fb44e}} 
{\bfseries subscriber}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 26 of file robot\+\_\+following.\+py.



\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classrobot__following_1_1image__feature_ad21c13434a4653ea1a64fb00a742a3ae}\label{classrobot__following_1_1image__feature_ad21c13434a4653ea1a64fb00a742a3ae}} 
\index{robot\+\_\+following\+::image\+\_\+feature@{robot\+\_\+following\+::image\+\_\+feature}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!robot\+\_\+following\+::image\+\_\+feature@{robot\+\_\+following\+::image\+\_\+feature}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}}
{\footnotesize\ttfamily def robot\+\_\+following.\+image\+\_\+feature.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Initialize ros publisher, ros subscriber\end{DoxyVerb}
 

Definition at line 28 of file robot\+\_\+following.\+py.


\begin{DoxyCode}
28     \textcolor{keyword}{def }\hyperlink{classstate__machine_1_1Play_a5993a23d8be7f7b2647f71ede0334957}{\_\_init\_\_}(self):
29         \textcolor{stringliteral}{'''Initialize ros publisher, ros subscriber'''}
30         rospy.init\_node(\textcolor{stringliteral}{'image\_feature'}, anonymous=\textcolor{keyword}{True})
31      \textcolor{comment}{# topic where we publish}
32         self.image\_pub = rospy.Publisher(\textcolor{stringliteral}{"/output/image\_raw/compressed"},
33                                          CompressedImage, queue\_size=1)
34         self.vel\_pub = rospy.Publisher(\textcolor{stringliteral}{"cmd\_vel"},
35                                        Twist, queue\_size=1)
36 
37         \textcolor{comment}{# subscribed Topic}
38         self.subscriber = rospy.Subscriber(\textcolor{stringliteral}{"camera1/image\_raw/compressed"},
39                                            CompressedImage, self.callback,  queue\_size=1)
40 
\end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classrobot__following_1_1image__feature_af3eddd8a93175ab03651d9ea0352ab56}\label{classrobot__following_1_1image__feature_af3eddd8a93175ab03651d9ea0352ab56}} 
\index{robot\+\_\+following\+::image\+\_\+feature@{robot\+\_\+following\+::image\+\_\+feature}!callback@{callback}}
\index{callback@{callback}!robot\+\_\+following\+::image\+\_\+feature@{robot\+\_\+following\+::image\+\_\+feature}}
\subsubsection{\texorpdfstring{callback()}{callback()}}
{\footnotesize\ttfamily def robot\+\_\+following.\+image\+\_\+feature.\+callback (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{ros\+\_\+data }\end{DoxyParamCaption})}

\begin{DoxyVerb}Callback function of subscribed topic. 
Here images get converted and features detected\end{DoxyVerb}
 

Definition at line 41 of file robot\+\_\+following.\+py.


\begin{DoxyCode}
41     \textcolor{keyword}{def }callback(self, ros\_data):
42         \textcolor{stringliteral}{'''Callback function of subscribed topic. }
43 \textcolor{stringliteral}{        Here images get converted and features detected'''}
44         \textcolor{keywordflow}{if} VERBOSE:
45             \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'received image of type: "%s"'} % ros\_data.format)
46 
47         
48         np\_arr = np.fromstring(ros\_data.data, np.uint8)
49         image\_np = cv2.imdecode(np\_arr, cv2.IMREAD\_COLOR)  \textcolor{comment}{# OpenCV >= 3.0:}
50 
51         orangeLower = (10, 50, 20)
52         orangeUpper = (20, 255, 255)
53 
54         blurred = cv2.GaussianBlur(image\_np, (11, 11), 0)
55         hsv = cv2.cvtColor(blurred, cv2.COLOR\_BGR2HSV)
56         mask = cv2.inRange(hsv, orangeLower, orangeUpper)
57         mask = cv2.erode(mask, \textcolor{keywordtype}{None}, iterations=2)
58         mask = cv2.dilate(mask, \textcolor{keywordtype}{None}, iterations=2)
59         \textcolor{comment}{#cv2.imshow('mask', mask)}
60         cnts = cv2.findContours(mask.copy(), cv2.RETR\_EXTERNAL,
61                                 cv2.CHAIN\_APPROX\_SIMPLE)
62         cnts = imutils.grab\_contours(cnts)
63         center = \textcolor{keywordtype}{None}
64         \textcolor{comment}{# only proceed if at least one contour was found}
65         \textcolor{keywordflow}{if} len(cnts) > 0:
66             \textcolor{comment}{# find the largest contour in the mask, then use}
67             \textcolor{comment}{# it to compute the minimum enclosing circle and}
68             \textcolor{comment}{# centroid}
69             c = max(cnts, key=cv2.contourArea)
70             ((x, y), radius) = cv2.minEnclosingCircle(c)
71             M = cv2.moments(c)
72             center = (int(M[\textcolor{stringliteral}{"m10"}] / M[\textcolor{stringliteral}{"m00"}]), int(M[\textcolor{stringliteral}{"m01"}] / M[\textcolor{stringliteral}{"m00"}]))
73 
74             \textcolor{comment}{# only proceed if the radius meets a minimum size}
75             \textcolor{keywordflow}{if} radius > 10:
76                 \textcolor{comment}{# draw the circle and centroid on the frame,}
77                 \textcolor{comment}{# then update the list of tracked points}
78                 cv2.circle(image\_np, (int(x), int(y)), int(radius),
79                            (0, 255, 255), 2)
80                 cv2.circle(image\_np, center, 5, (0, 0, 255), -1)
81                 vel = Twist()
82                 vel.angular.z = -0.002*(center[0]-400)
83                 vel.linear.x = -0.01*(radius-100)
84                 self.vel\_pub.publish(vel)
85             \textcolor{keywordflow}{else}:
86                 vel = Twist()
87                 vel.linear.x = 0.5
88                 self.vel\_pub.publish(vel)
89 
90         \textcolor{keywordflow}{else}:
91             vel = Twist()
92             vel.angular.z = 0.5
93             self.vel\_pub.publish(vel)
94 
95         cv2.imshow(\textcolor{stringliteral}{'window'}, image\_np)
96         cv2.waitKey(2)
97 
98         \textcolor{comment}{# self.subscriber.unregister()}
99 
100 
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/home/sara/catkin\+\_\+ws/src/bridge\+\_\+example/scripts/robot\+\_\+following.\+py\end{DoxyCompactItemize}
