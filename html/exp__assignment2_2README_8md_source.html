<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exp_Assignment2: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exp_Assignment2
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Assignment 2 - Experimental Robotics Laboratory </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;# Introduction </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;The ROS package simulates a dog robot which can move freely in an arena (gridden area, 8x8) and can have three different behaviors: sleep, normal and play. A green ball is also implemented that can move randomly in the environment. </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;In sleep state, the robot reaches him home (7,7,0) and wait for a while; </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;In normal state, the robot searches the ball: if he finds the ball then he will start to play, otherwise he will move randomly around the arena; </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;In play state, the robot tracks the ball, when he is close to it, then rotates the head, continuing to track the ball as well. </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;The robot is a wheeled dog robot and the differential drive plugin is used, he has a neck (fixed joint), a head (that can rotate  with respect z axis) and a camera on the top; instead the ball is a robot with one link and the planar_move plugin. </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The nodes are written in Python and the environment used for the simulation is Gazebo. </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;The motions of both robots are implemented with two actionlib client-server, and the visualization of the camera is allowed by OpenCV: CV_bridge library is used to interface ROS and OpenCV by converting ROS images into OpenCV images, and vice-versa. </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;# Software achitecture and states diagrams </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The system is composed by four nodes, written in Python, present in the Scripts folder: </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; - &quot;go_to_point_ball.py&quot; is the actionlib server to move the ball; </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; - &quot;go_to_point_robot.py&quot; is the actionlib server to move the robot; </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; - &quot;move_ball_around.py&quot; is the actionlib client to move the ball (it simulates the human commands); </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; - &quot;state_machine.py&quot; is the node in which the state machine is implemented for simulating the three behaviors of the robot. </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;A launch file &quot;gazebo_world.launch&quot; is provided to start gazebo, to run simultaneously every nodes and to launch the spawner for the robots.</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;### Go_to_point_ball.py </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;The node implements the actionlib server to move the ball. The ball can move around in the arena, and can disappear, moving along z axis (it is possible to do this, because the ball has been defined with no collision elements and zero gravity). </div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;### Go_to_point_robot.py </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;The node implements the actionlib server to move the robot. It is quite different from the previous node, because the robot is wheeled and it has the differential_drive plugin. </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;The dog robot can move around in the arena. </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;### move_ball_around.py </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;It is a simply actionlib client that simulates the human commands for moving the ball. </div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;The function &quot;move_ball&quot; is defined to send the goal position to the server (using &quot;/reaching_goal/goal&quot; topic). </div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;For twice, the ball reaches a random goal position and waits for 50 secs, then it disappears (moves on z axis) and waits again for 50 secs (In loop). </div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;### State_machine.py </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;It is the main node because it implements a state machine and allows the dog robot to perform the three possible behaviors (Sleep, Normal and Play). </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;In order to perform this, Smach library is imported. </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;In the Normal state, the robot can perform two possible actions (choosen randomly by &quot;user_action&quot; function): can switch in sleep state or can search for the ball, subscribing to the &quot;camera1/image_raw/compressed&quot; topic. Using OpenCV to show the image from the camera, the following window will be opened </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;&lt;p align=&quot;center&quot;&gt; </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;&lt;img src=&quot;https://github.com/sararom15/exp_assignment2/blob/main/images/window_ball.png&quot;&gt;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;If the ball is found, then it switches in Play state, otherwise it moves randomly: &quot;move_dog&quot; function is defined to send the goal position to the server of the robot (using &quot;/robot_reaching_goal/goal&quot; topic). </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;In the Sleep state, the robot just goes to a desired position (7,7,0) and stays there for a while (14 seconds defined). Then it enters again in Normal state. </div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;In the Play state, the robot starts to follow the ball in the arena; when the ball is reached the robot stops mantaining an appropriated distance from the ball (the &quot;image_feature&quot; instance has been called for doing that); then the robot rotates his head to the left, waits for a while, and rotates again to the right side and waits for a while as well. Once he completed his performance, continues to track the ball and follows it. In case the ball disappers, the robot enters in Normal state. </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;## ROS messages and Parameters </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;In the Action folder, the &quot;Planning.action&quot; is defined. This ROS message is used by the two server-client actionlib. It includes: </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; - goal: geometry_msgs.msgs/Pose Stamped target_pose </div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; - result: uint32 reached_position </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; - feedback: string stat, geometry_msgs.mgs/Pose position </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;The ROS parameters are used in state_machine node; they are: </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; - count: Used in Play state;  it goes from 0 to 360 and counts the num of time in which the robot does not see the ball (it is able to perform an entire turn on itself); when it gets equal to 360, then he passes in Normal state. </div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; - camera_rotate:Used in Play state as well. It is a boolean parameter, always setted to 0, but when the robot reaches the ball it is set to 1, in order to start to rotate the head. </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; - count2: it has the same purpuse of the &quot;count&quot; parameter, but used in Normal state. </div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; - DetectedBall: Used in Normal state. It is a boolean parameter: switches to 1 when the ball is detected, in order to enter in Play state. </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;# Package and file list </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;There exists some folders in the package: </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; - World folder: contains the ROS world file, ti create the environment in Gazebo (gridden arena). </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;&lt;p align=&quot;center&quot;&gt; </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;&lt;img src=&quot;https://github.com/sararom15/exp_assignment2/blob/main/images/Environment.png&quot;&gt;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; - Urdf folder: cointains the xacro, urdf and gazebo files of the robot, the ball and the human. Here the URDF models are defined. </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;&lt;p align=&quot;center&quot;&gt; </div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;&lt;img src=&quot;https://github.com/sararom15/exp_assignment2/blob/main/images/URDFRobot_graph.png&quot;&gt;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;&lt;p align=&quot;center&quot;&gt; </div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;&lt;img src=&quot;https://github.com/sararom15/exp_assignment2/blob/main/images/Dog_robot.png&quot;&gt;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;&lt;/p&gt;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; - Launch folder: cointains the launch file. </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; - Scripts folder: cointains the Python files (already discussed in the previous paragraph) </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; - Config folder: contains the config file for the single motor of the robot (used to rotate the head - yam). </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; - Action folder: contains the action file (already discussed as well). </div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;According to the ROS package, the CMakeLists.txt and package.xml are present too. </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;# Installation</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;The first thing to do, after having cloned the repository in the Ros workspace, is to install the package, using the following commands in the shell:</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    ```</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    cd &quot;yourWorkspace&quot;_ws/src/exp_assignment2</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    chmod +x install.sh </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    ./install.sh </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    ```</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;Then, run the system: </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    ```</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    roslaunch exp_assignment2 gazebo_world.launch</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    </div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    ```</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;# System&#39;s features </div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;This system is improving the previous assignment. </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;The environment is simulated with the Gazebo GUI. Moreover, what the robot is doing and what the behavior&#39;s state is executing are printed on the Terminal. </div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;# System&#39;s limitations and technical improvements </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;Sometimes, in Play state, the num of interactions (&quot;count&quot; parameter) finishes before to check the presence of the ball in the arena: this means that the robot cannot perform an entire turn on itself and he cannot see the ball, so enters in the Normal state. Nevertheless, in the normal state, before to move randomly, a checking of the ball presence is done: therefore in case the ball is included, the robot can switch again in Play state. </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;The view of the dog robot (the xacro file) can be improved, in order to make it look more like a dog. </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;# Author and contact</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;Sara Romano - S4802844</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;sara.romano.15@gmail.com</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
